# Integration Pipeline

End-to-end pipeline for compiling tests, running coverage, filtering/reducing
LLM-generated tests, and comparing adopted vs generated tests.

## Layout

- `run_integration_pipeline.sh` - main entrypoint
- `src/` - pipeline modules
- `libs/` - Java dependencies for test execution
- `jacoco-deps/` - JaCoCo agent jar
- `coverage-filter-1.0-SNAPSHOT.jar` - CoverageFilterApp tool
- `build/` - compiled test classes (generated by the pipeline)
- `jacoco-out/` - coverage outputs and logs
- `results/` - pipeline outputs (if used by your flow)

## Quick start

From `integration_pipeline`:

```bash
./run_integration_pipeline.sh \
  ../_logs/tests_inventory.csv \
  ../../out/cut_to_fatjar_map.csv \
  all
```

## Steps

The script accepts a step argument (default: `all`).

Priority order (recommended run sequence):

1) `compile`
2) `run`
3) `filter`  
4) `reduce`  
5) `send`  
6) `compare`  
7) `adopted-run`
8) `adopted-filter`  
9) `adopted-reduce`  

Step descriptions:

- `compile` - compile generated and manual tests, resolve dependencies, and build test classpaths under `build/`.
- `run` - execute generated/manual tests with JaCoCo and write `coverage_summary.csv`.
- `filter` - run CoverageFilterApp to identify tests with coverage signal (uses fatjar + libs).
- `reduce` - create reduced generated tests (top-N) based on coverage deltas.
- `send` - send reduced tests + manual tests to the LLM adapter to produce adopted tests.
- `compare` - compare adopted vs generated tests (PMD/CPD + tri-compare metrics).
- `adopted-run` - execute adopted tests with JaCoCo and write `adopted_coverage_summary.csv`.
- `adopted-filter` - run CoverageFilterApp using adopted + manual tests to compute deltas.
- `adopted-reduce` - reduce adopted tests (default top 5; `--adopted-reduce-max-tests`).
- `all` - run all steps in the priority order above.

## Inputs

- `tests_inventory.csv` (from collected tests)
- `cut_to_fatjar_map.csv` (from fatjar build)
- `libs/*` for JUnit and runtime deps
- `coverage-filter-1.0-SNAPSHOT.jar`
- `jacoco-deps/org.jacoco.agent-run-0.8.14.jar`
- adopted tests output root (`--adopted-dir`, default `result/llm-out`)

## Outputs

- `build/` compiled test classes
- `tmp/` logs, coverage exec files, and summaries
  - `tmp/coverage_summary.csv`
  - `tmp/adopted_coverage_summary.csv`
- `result/` intermediate artifacts (covfilter/reduced/compare)
  - `result/covfilter/` (generated covfilter outputs)
  - `result/reduced-agt/` (reduced generated tests)
  - `result/covfilter-adopted/` (adopted covfilter outputs)
  - `result/reduced-adopted/` (reduced adopted tests)
  - `result/compare/` (comparison CSVs)

## Notes

- The launcher uses `python -m integration_pipeline.pipeline_main` and assumes
  module sources are in `src/`.
- Coverage summary CSVs are tracked in git; everything else under `jacoco-out/`
  is ignored by default.
